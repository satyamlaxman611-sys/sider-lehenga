<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Checkout | Sider Lehenga</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Razorpay Checkout JS -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
:root{
  --bg:#0b0b0b;
  --card:#111;
  --soft:#181818;
  --gold:#f5c97a;
  --gold-soft:rgba(245,201,122,.35);
  --text:#f5f5f5;
  --muted:#bdbdbd;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* ===== HEADER ===== */
header{
  position:sticky;
  top:0;
  z-index:10;
  background:#000;
  padding:14px 16px;
  border-bottom:1px solid var(--gold-soft);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-weight:800;
  letter-spacing:1px;
  color:var(--gold);
  cursor:pointer;
}

.cart{
  cursor:pointer;
}

/* ===== LAYOUT ===== */
.container{
  max-width:480px;
  margin:auto;
  padding:16px;
}

/* ===== CARD ===== */
.card{
  background:var(--card);
  border:1px solid var(--gold-soft);
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
}

/* ===== FORM ===== */
label{
  font-size:13px;
  color:var(--muted);
  display:block;
  margin-bottom:6px;
}

input,textarea{
  width:100%;
  padding:12px;
  border-radius:10px;
  background:var(--soft);
  border:1px solid var(--gold-soft);
  color:var(--text);
  margin-bottom:14px;
  font-size:14px;
}

textarea{resize:none}

/* ===== ORDER SUMMARY ===== */
.summary-row{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-bottom:10px;
}

.total{
  font-size:18px;
  font-weight:700;
  color:var(--gold);
}

/* ===== BUTTON ===== */
.pay-btn{
  width:100%;
  padding:16px;
  border-radius:14px;
  font-size:16px;
  font-weight:800;
  background:var(--gold);
  color:#000;
  border:none;
  cursor:pointer;
}

.pay-btn:active{
  transform:scale(.98);
}

/* ===== FOOTER ===== */
footer{
  text-align:center;
  padding:20px;
  font-size:13px;
  color:#888;
  border-top:1px solid var(--gold-soft);
}
</style>
</head>

<body>

<header>
  <div class="logo" onclick="location.href='index.html'">SIDER LEHENGA</div>
  <div class="cart" onclick="location.href='cart.html'">üõí</div>
</header>

<main class="container">

  <!-- CUSTOMER DETAILS -->
  <div class="card">
    <h3>Customer Details</h3>

    <label>Full Name</label>
    <input id="name" placeholder="Enter full name">

    <label>Contact Number</label>
    <input id="phone" placeholder="10 digit mobile number">

    <label>Delivery Address</label>
    <textarea id="address" rows="3" placeholder="Village / Area / Landmark"></textarea>
  </div>

  <!-- ORDER SUMMARY -->
  <div class="card">
    <h3>Order Summary</h3>
    <div id="summary"></div>
    <div class="summary-row total">
      <span>Total</span>
      <span id="totalPrice">‚Çπ0</span>
    </div>
  </div>

  <!-- PAY BUTTON -->
  <button class="pay-btn" onclick="payNow()">PAY NOW</button>

</main>

<footer>
  ¬© 2025 Sider Lehenga ‚Ä¢ Secure Checkout
</footer>

<script>
let cart = JSON.parse(localStorage.getItem("cart") || "[]");
let totalAmount = 0;

/* ===== LOAD SUMMARY ===== */
function loadSummary(){
  const wrap = document.getElementById("summary");
  wrap.innerHTML = "";
  totalAmount = 0;

  cart.forEach(item=>{
    totalAmount += item.price * (item.qty || 1);

    const row = document.createElement("div");
    row.className = "summary-row";
    row.innerHTML = `
      <span>${item.title}</span>
      <span>‚Çπ${item.price}</span>
    `;
    wrap.appendChild(row);
  });

  document.getElementById("totalPrice").innerText = "‚Çπ" + totalAmount;
}

loadSummary();

/* ===== PAY NOW ===== */
async function payNow(){
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();

  if(!name || !phone || !address){
    alert("Please fill all details");
    return;
  }

  /* ---- BACKEND ORDER CREATE (LAPTOP PHASE) ---- */
  const orderRes = await fetch("/api/create-order", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ amount: totalAmount })
  });

  const order = await orderRes.json();

  const options = {
    key: "rzp_live_Ruvu1unwMkK27t", // SAFE PLACEHOLDER
    amount: order.amount,
    currency: "INR",
    name: "Sider Lehenga",
    description: "Order Payment",
    order_id: order.id,
    handler: function (response) {
      verifyPayment(response);
    },
    prefill:{
      name,
      contact: phone
    },
    theme:{
      color:"#f5c97a"
    }
  };

  const rzp = new Razorpay(options);
  rzp.open();
}

/* ===== VERIFY PAYMENT ===== */
async function verifyPayment(data){
  const res = await fetch("/api/verify-payment", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(data)
  });

  const result = await res.json();

  if(result.success){
    localStorage.removeItem("cart");
    alert("Payment Successful ‚úÖ");
    location.href = "index.html";
  }else{
    alert("Payment verification failed ‚ùå");
  }
}
</script>

</body>
</html>