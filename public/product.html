<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Product Detail | Sider Lehenga</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg-main:#111111;
  --bg-card:#0d0d0d;
  --bg-soft:#161616;
  --gold-main:#f5c97a;
  --gold-soft:rgba(245,201,122,.3);
  --gold-glow:rgba(245,201,122,.6);
  --text-main:#f5f5f5;
  --text-muted:#bdbdbd;
  --text-faint:#8a8a8a;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg-main);
  color:var(--text-main);
  line-height:1.6;
}

/* HEADER */
header{
  position:sticky;
  top:0;
  z-index:20;
  background:#000;
  padding:14px 16px;
  border-bottom:1px solid var(--gold-soft);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  color:var(--gold-main);
  font-weight:800;
  font-size:16px;
  letter-spacing:1px;
  text-shadow:0 0 12px var(--gold-glow);
  cursor:pointer;
}

.header-right{
  display:flex;
  gap:18px;
  align-items:center;
}

.back-btn, .cart-btn, .menu-btn{
  font-size:18px;
  color:var(--gold-main);
  cursor:pointer;
  transition:0.3s;
}

.back-btn:hover, .cart-btn:hover, .menu-btn:hover{
  transform:scale(1.1);
}

/* CONTAINER */
.container{
  max-width:1200px;
  margin:auto;
  padding:16px;
}

/* PRODUCT DETAIL LAYOUT */
.product-detail{
  display:grid;
  gap:24px;
  margin-bottom:40px;
}

@media(min-width:768px){
  .product-detail{
    grid-template-columns:1fr 1fr;
    gap:32px;
  }
}

/* IMAGE GALLERY WITH SLIDER */
.product-gallery{
  position:relative;
}

.main-image-wrapper{
  position:relative;
  overflow:hidden;
  border-radius:12px;
  border:1px solid var(--gold-soft);
  aspect-ratio:3/4;
  background:var(--bg-soft);
}

.main-image-slider{
  display:flex;
  height:100%;
  transition:transform 0.3s ease;
  touch-action:pan-y pinch-zoom;
}

.main-image-slider img{
  width:100%;
  height:100%;
  flex-shrink:0;
  object-fit:cover;
  cursor:zoom-in;
  user-select:none;
}

.image-counter{
  position:absolute;
  top:12px;
  right:12px;
  background:rgba(0,0,0,0.7);
  color:var(--gold-main);
  padding:6px 12px;
  border-radius:20px;
  font-size:12px;
  font-weight:600;
  backdrop-filter:blur(4px);
  z-index:2;
}

.main-nav-btn{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:rgba(0,0,0,0.6);
  color:var(--gold-main);
  width:40px;
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  cursor:pointer;
  font-size:24px;
  transition:0.3s;
  z-index:2;
  user-select:none;
}

.main-nav-btn:hover{
  background:var(--gold-main);
  color:#000;
}

.main-prev{left:10px}
.main-next{right:10px}

.thumbnail-strip{
  display:flex;
  gap:8px;
  margin-top:12px;
  overflow-x:auto;
  padding-bottom:8px;
  scroll-behavior:smooth;
}

.thumbnail-strip::-webkit-scrollbar{
  height:4px;
}

.thumbnail-strip::-webkit-scrollbar-track{
  background:var(--bg-soft);
  border-radius:2px;
}

.thumbnail-strip::-webkit-scrollbar-thumb{
  background:var(--gold-soft);
  border-radius:2px;
}

.thumbnail{
  min-width:60px;
  width:60px;
  height:80px;
  object-fit:cover;
  border-radius:6px;
  border:2px solid transparent;
  cursor:pointer;
  transition:0.3s;
}

.thumbnail:hover{
  transform:scale(1.05);
}

.thumbnail.active{
  border-color:var(--gold-main);
  box-shadow:0 0 12px var(--gold-glow);
}

/* PRODUCT INFO */
.product-info{
  padding:10px 0;
}

.product-title{
  font-size:24px;
  font-weight:700;
  margin-bottom:12px;
  line-height:1.3;
  color:var(--gold-main);
}

.price-section{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:16px;
  flex-wrap:wrap;
}

.product-price{
  font-size:32px;
  color:var(--gold-main);
  font-weight:800;
}

.compare-price{
  text-decoration:line-through;
  color:var(--text-faint);
  font-size:20px;
}

.discount-badge{
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:#fff;
  padding:6px 12px;
  border-radius:6px;
  font-weight:700;
  font-size:14px;
}

.rating-section{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:20px;
  padding:10px 0;
  border-top:1px solid var(--gold-soft);
  border-bottom:1px solid var(--gold-soft);
}

.stars{
  color:#ffd700;
  font-size:18px;
  letter-spacing:2px;
}

.rating-text{
  color:var(--text-muted);
  font-size:14px;
}

/* DESCRIPTION SECTIONS */
.description-section{
  margin-bottom:24px;
}

.section-title{
  font-size:16px;
  font-weight:700;
  color:var(--gold-main);
  margin-bottom:10px;
  display:flex;
  align-items:center;
  gap:8px;
}

.section-content{
  color:var(--text-muted);
  line-height:1.8;
}

.feature-list{
  list-style:none;
  padding:0;
}

.feature-list li{
  padding:8px 0;
  padding-left:24px;
  position:relative;
  color:var(--text-muted);
}

.feature-list li:before{
  content:"‚úì";
  position:absolute;
  left:0;
  color:var(--gold-main);
  font-weight:700;
}

.specs-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));
  gap:12px;
  margin-top:12px;
}

.spec-item{
  background:var(--bg-soft);
  padding:12px;
  border-radius:8px;
  border:1px solid var(--gold-soft);
}

.spec-label{
  font-size:12px;
  color:var(--text-faint);
  margin-bottom:4px;
}

.spec-value{
  font-weight:600;
  color:var(--gold-main);
}

/* SIZE GUIDE */
.size-guide{
  background:var(--bg-soft);
  padding:16px;
  border-radius:8px;
  border:1px solid var(--gold-soft);
  margin-bottom:20px;
}

.size-options{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:12px;
}

.size-option{
  padding:10px 18px;
  border:2px solid var(--gold-soft);
  border-radius:6px;
  cursor:pointer;
  transition:0.3s;
  font-weight:600;
}

.size-option:hover, .size-option.selected{
  border-color:var(--gold-main);
  background:var(--gold-soft);
  color:var(--gold-main);
}

/* ACTION BUTTONS - SINGLE ROW */
.action-buttons{
  display:grid;
  grid-template-columns:1fr 1fr auto;
  gap:10px;
  margin-top:24px;
}

@media(max-width:480px){
  .action-buttons{
    grid-template-columns:1fr 1fr;
  }
  
  .btn-share{
    grid-column:1 / -1;
  }
}

.btn{
  padding:14px 20px;
  border:none;
  border-radius:8px;
  font-weight:700;
  font-size:15px;
  cursor:pointer;
  transition:all 0.3s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}

.btn-primary{
  background:var(--gold-main);
  color:#000;
  box-shadow:0 4px 12px var(--gold-glow);
}

.btn-primary:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 20px var(--gold-glow);
}

.btn-secondary{
  background:var(--bg-soft);
  color:var(--gold-main);
  border:2px solid var(--gold-main);
}

.btn-secondary:hover{
  background:var(--gold-soft);
  transform:translateY(-2px);
}

.btn-share{
  background:var(--gold-main);
  color:#000;
  padding:14px 18px;
  min-width:50px;
  box-shadow:0 4px 12px var(--gold-glow);
}

.btn-share:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 20px var(--gold-glow);
}

/* SIMILAR PRODUCTS */
.similar-section{
  margin-top:50px;
  padding-top:30px;
  border-top:2px solid var(--gold-soft);
}

.similar-title{
  font-size:20px;
  font-weight:700;
  margin-bottom:20px;
  color:var(--gold-main);
  display:flex;
  align-items:center;
  gap:10px;
}

.horizontal-scroll{
  display:flex;
  gap:14px;
  overflow-x:auto;
  padding-bottom:14px;
  scroll-behavior:smooth;
}

.horizontal-scroll::-webkit-scrollbar{
  height:6px;
}

.horizontal-scroll::-webkit-scrollbar-track{
  background:var(--bg-soft);
  border-radius:3px;
}

.horizontal-scroll::-webkit-scrollbar-thumb{
  background:var(--gold-soft);
  border-radius:3px;
}

.horizontal-scroll::-webkit-scrollbar-thumb:hover{
  background:var(--gold-main);
}

.mini-card{
  min-width:160px;
  max-width:160px;
  background:var(--bg-card);
  border:1px solid var(--gold-soft);
  border-radius:10px;
  overflow:hidden;
  cursor:pointer;
  transition:0.3s ease;
}

.mini-card:hover{
  transform:translateY(-4px);
  box-shadow:0 8px 24px rgba(245,201,122,.35);
}

.mini-card img{
  width:100%;
  aspect-ratio:3/4;
  object-fit:cover;
}

.mini-card-body{
  padding:10px;
}

.mini-card-title{
  font-size:12px;
  line-height:1.3;
  height:32px;
  overflow:hidden;
  margin-bottom:6px;
}

.mini-card-price{
  color:var(--gold-main);
  font-weight:700;
  font-size:14px;
}

/* LIGHTBOX */
.lightbox{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.96);
  z-index:999;
  justify-content:center;
  align-items:center;
  animation:fadeIn 0.2s ease;
}

@keyframes fadeIn{
  from{opacity:0}
  to{opacity:1}
}

.lightbox.active{
  display:flex;
}

.lightbox-content{
  position:relative;
  max-width:90%;
  max-height:90%;
  animation:zoomIn 0.3s ease;
}

@keyframes zoomIn{
  from{transform:scale(0.8);opacity:0}
  to{transform:scale(1);opacity:1}
}

.lightbox-content img{
  max-width:100%;
  max-height:90vh;
  object-fit:contain;
  border-radius:8px;
}

.lightbox-close{
  position:absolute;
  top:20px;
  right:20px;
  font-size:36px;
  color:var(--gold-main);
  cursor:pointer;
  z-index:1000;
  width:50px;
  height:50px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,0.8);
  border-radius:50%;
  transition:0.3s;
}

.lightbox-close:hover{
  background:var(--gold-main);
  color:#000;
  transform:rotate(90deg);
}

.lightbox-nav{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  font-size:48px;
  color:var(--gold-main);
  cursor:pointer;
  padding:15px 20px;
  user-select:none;
  background:rgba(0,0,0,0.7);
  border-radius:8px;
  transition:0.3s;
}

.lightbox-nav:hover{
  background:var(--gold-main);
  color:#000;
}

.lightbox-prev{left:20px}
.lightbox-next{right:20px}

.lightbox-counter{
  position:absolute;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.8);
  color:var(--gold-main);
  padding:10px 20px;
  border-radius:24px;
  font-size:15px;
  font-weight:700;
  backdrop-filter:blur(6px);
}

/* FOOTER */
footer{
  margin-top:60px;
  padding:30px 16px;
  border-top:1px solid var(--gold-soft);
  text-align:center;
  font-size:13px;
  color:var(--text-faint);
  background:var(--bg-card);
}

/* LOADING */
.loading{
  text-align:center;
  padding:80px 20px;
}

.spinner{
  width:50px;
  height:50px;
  border:5px solid var(--gold-soft);
  border-top-color:var(--gold-main);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:0 auto 20px;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}

/* TOAST NOTIFICATION */
.toast{
  position:fixed;
  bottom:30px;
  left:50%;
  transform:translateX(-50%) translateY(150px);
  background:var(--gold-main);
  color:#000;
  padding:16px 24px;
  border-radius:8px;
  font-weight:700;
  box-shadow:0 8px 24px rgba(245,201,122,.5);
  z-index:1000;
  transition:transform 0.3s ease;
}

.toast.show{
  transform:translateX(-50%) translateY(0);
}
</style>
</head>

<body>

<header>
  <div class="back-btn" onclick="history.back()">‚Üê Back</div>
  <div class="logo" onclick="location.href='index.html'">SIDER LEHENGA</div>
  <div class="header-right">
    <div class="cart-btn" onclick="location.href='cart.html'">üõí</div>
  </div>
</header>

<main class="container">

  <div id="loadingState" class="loading">
    <div class="spinner"></div>
    <div style="color:var(--gold-main)">Loading product details...</div>
  </div>

  <div id="productContent" style="display:none">
    
    <div class="product-detail">
      
      <!-- GALLERY WITH SWIPE -->
      <div class="product-gallery">
        <div class="main-image-wrapper">
          <div class="image-counter" id="imageCounter">1 / 1</div>
          <div class="main-nav-btn main-prev" onclick="changeMainImage(-1)">‚Äπ</div>
          <div class="main-image-slider" id="mainImageSlider"></div>
          <div class="main-nav-btn main-next" onclick="changeMainImage(1)">‚Ä∫</div>
        </div>
        <div class="thumbnail-strip" id="thumbnailStrip"></div>
      </div>
      
      <!-- PRODUCT INFO -->
      <div class="product-info">
        <h1 class="product-title" id="productTitle"></h1>
        
        <div class="price-section">
          <span class="product-price" id="productPrice"></span>
          <span class="compare-price" id="comparePrice"></span>
          <span class="discount-badge" id="discountBadge" style="display:none"></span>
        </div>
        
        <div class="rating-section">
          <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <span class="rating-text">4.8 (152 reviews)</span>
        </div>
        
        <!-- SHORT DESCRIPTION -->
        <div class="description-section">
          <div class="section-title">üìù Product Description</div>
          <div class="section-content" id="productDesc"></div>
        </div>
        
        <!-- KEY FEATURES -->
        <div class="description-section">
          <ul class="feature-list" id="featureList">
  <!-- Features will be loaded dynamically -->
</ul>
        </div>
        
        <!-- SPECIFICATIONS -->
        <div class="description-section">
          <div class="section-title">Care Details</div>
          <div class="specs-grid">
            <div class="spec-item">
              <div class="spec-label">Iron</div>
              <div class="spec-value">Soft Press</div>
            </div>
            <div class="spec-item">
              <div class="spec-label">Dry</div>
              <div class="spec-value">Low Sunlight</div>
            </div>
            <div class="spec-item">
              <div class="spec-label">Wash</div>
              <div class="spec-value">Avoid Bleach & Hot Water</div>
            </div>
            <div class="spec-item">
              <div class="spec-label">Store</div>
              <div class="spec-value">Avoid direct Sunlight </div>
            </div>
          </div>
        </div>
        
        <!-- SIZE SELECTION -->
        <div class="size-guide">
          <div class="section-title">Select Size</div>
          <div class="size-options">
            <div class="size-option" onclick="selectSize(this)">S</div>
            <div class="size-option selected" onclick="selectSize(this)">M</div>
            <div class="size-option" onclick="selectSize(this)">L</div>
            <div class="size-option" onclick="selectSize(this)">XL</div>
            <div class="size-option" onclick="selectSize(this)">XXL</div>
          </div>
        </div>
        
        <!-- ACTION BUTTONS IN SINGLE ROW -->
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="addToCart()">
            <span>üõí</span>
            <span>Add to Cart</span>
          </button>
          <button class="btn btn-secondary" onclick="buyNow()">
            <span>‚ö°</span>
            <span>Buy Now</span>
          </button>
          <button class="btn btn-share" onclick="shareProduct()" title="Share Product">
            <span>‚å≤</span>
          </button>
        </div>
        
      </div>
      
    </div>
    
    <!-- SIMILAR PRODUCTS (RANDOM FOR EACH PRODUCT) -->
    <div class="similar-section">
      <div class="similar-title">
        <span>‚ú®</span>
        <span>You May Also Like</span>
      </div>
      <div class="horizontal-scroll" id="similarProducts"></div>
    </div>
    
  </div>

</main>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <div class="lightbox-close" onclick="closeLightbox()">‚úï</div>
  <div class="lightbox-nav lightbox-prev" onclick="event.stopPropagation();changeLightboxImage(-1)">‚Äπ</div>
  <div class="lightbox-content" onclick="event.stopPropagation()">
    <img id="lightboxImg" src="" alt="">
  </div>
  <div class="lightbox-nav lightbox-next" onclick="event.stopPropagation();changeLightboxImage(1)">‚Ä∫</div>
  <div class="lightbox-counter" id="lightboxCounter"></div>
</div>

<footer>
  <div>¬© 2025 Sider Lehenga ‚Ä¢ Premium Ethnic Wear ‚Ä¢ Made in India üáÆüá≥</div>
</footer>

<script>
let currentProduct = null;
let allProducts = [];
let currentMainIndex = 0;
let currentLightboxIndex = 0;
let selectedSize = "M";

async function loadProduct(){
  try {
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');
    
    if(!productId){
      location.href = 'products.html';
      return;
    }
    
    const res = await fetch("products-data.json");
    const data = await res.json();
    allProducts = data.filter(p => p.visible !== false);
    
    currentProduct = allProducts.find(p => p.id == productId);
    
    if(!currentProduct){
      alert("Product not found!");
      location.href = 'products.html';
      return;
    }
    
    renderProduct();
    loadSimilarProducts(currentProduct.id);
    
    document.getElementById("loadingState").style.display = "none";
    document.getElementById("productContent").style.display = "block";
    
  } catch(err) {
    alert("Failed to load product. Please try again.");
    console.error(err);
  }
}

function renderProduct(){
  // Title
  document.getElementById("productTitle").textContent = currentProduct.title;
  
  // Price
  document.getElementById("productPrice").textContent = `‚Çπ${currentProduct.price.toLocaleString('en-IN')}`;
  
  if(currentProduct.comparePrice){
    document.getElementById("comparePrice").textContent = `‚Çπ${currentProduct.comparePrice.toLocaleString('en-IN')}`;
    document.getElementById("comparePrice").style.display = "inline";
    
    const discount = Math.round((1 - currentProduct.price / currentProduct.comparePrice) * 100);
    if(discount > 0){
      document.getElementById("discountBadge").textContent = `${discount}% OFF`;
      document.getElementById("discountBadge").style.display = "inline-block";
    }
  }
  
  // Description (fetch from JSON only, no fallback text)
if(currentProduct.description && currentProduct.description.trim() !== ""){
  document.getElementById("productDesc").textContent = currentProduct.description;
} else {
  document.getElementById("productDesc").textContent = "Currently Description Unavailable";
}
  // Main Image Slider
  const mainSlider = document.getElementById("mainImageSlider");
  currentProduct.images.forEach((img, idx) => {
    const imgEl = document.createElement("img");
    imgEl.src = img;
    imgEl.alt = currentProduct.title;
    imgEl.loading = idx === 0 ? "eager" : "lazy";
    imgEl.draggable = false;
    imgEl.onclick = () => openLightbox(idx);
    mainSlider.appendChild(imgEl);
  });
  
  // Update counter
  updateImageCounter();
  
  // Touch/Swipe for main slider
  setupSwipeGesture(mainSlider);
  
  // Thumbnails
  const thumbStrip = document.getElementById("thumbnailStrip");
  currentProduct.images.forEach((img, idx) => {
    const thumb = document.createElement("img");
    thumb.src = img;
    thumb.alt = currentProduct.title;
    thumb.className = idx === 0 ? "thumbnail active" : "thumbnail";
    thumb.loading = "lazy";
    thumb.onclick = () => changeMainImage(idx, true);
    thumbStrip.appendChild(thumb);
  });
}

function setupSwipeGesture(slider){
  let startX = 0, currentX = 0, isDragging = false;
  
  slider.addEventListener("touchstart", (e) => {
    startX = e.touches[0].clientX;
    isDragging = true;
    slider.style.transition = "none";
  });
  
  slider.addEventListener("touchmove", (e) => {
    if(!isDragging) return;
    currentX = e.touches[0].clientX;
    const diff = currentX - startX;
    const offset = -(currentMainIndex * 100) + (diff / slider.offsetWidth * 100);
    slider.style.transform = `translateX(${offset}%)`;
  });
  
  slider.addEventListener("touchend", (e) => {
    if(!isDragging) return;
    isDragging = false;
    
    slider.style.transition = "transform 0.3s ease";
    const diff = startX - currentX;
    const threshold = 50;
    
    if(Math.abs(diff) > threshold){
      if(diff > 0 && currentMainIndex < currentProduct.images.length - 1){
        changeMainImage(1);
      } else if(diff < 0 && currentMainIndex > 0){
        changeMainImage(-1);
      } else {
        slider.style.transform = `translateX(-${currentMainIndex * 100}%)`;
      }
    } else {
      slider.style.transform = `translateX(-${currentMainIndex * 100}%)`;
    }
  });
}

function changeMainImage(direction, direct = false){
  if(direct){
    currentMainIndex = direction;
  } else {
    currentMainIndex += direction;
  }
  
  if(currentMainIndex < 0) currentMainIndex = 0;
  if(currentMainIndex >= currentProduct.images.length) currentMainIndex = currentProduct.images.length - 1;
  
  const slider = document.getElementById("mainImageSlider");
  slider.style.transform = `translateX(-${currentMainIndex * 100}%)`;
  
  updateImageCounter();
  updateThumbnailActive();
}

function updateImageCounter(){
  document.getElementById("imageCounter").textContent = `${currentMainIndex + 1} / ${currentProduct.images.length}`;
}

function updateThumbnailActive(){
  const thumbs = document.querySelectorAll(".thumbnail");
  thumbs.forEach((t, i) => {
    t.className = i === currentMainIndex ? "thumbnail active" : "thumbnail";
  });
}

function openLightbox(index){
  currentLightboxIndex = index;
  updateLightboxImage();
  document.getElementById("lightbox").classList.add("active");
  document.body.style.overflow = "hidden";
}

function closeLightbox(){
  document.getElementById("lightbox").classList.remove("active");
  document.body.style.overflow = "auto";
}

function changeLightboxImage(direction){
  currentLightboxIndex += direction;
  
  if(currentLightboxIndex < 0) currentLightboxIndex = currentProduct.images.length - 1;
  if(currentLightboxIndex >= currentProduct.images.length) currentLightboxIndex = 0;
  
  updateLightboxImage();
}

function updateLightboxImage(){
  document.getElementById("lightboxImg").src = currentProduct.images[currentLightboxIndex];
  document.getElementById("lightboxCounter").textContent = `${currentLightboxIndex + 1} / ${currentProduct.images.length}`;
}

// SHARE PRODUCT WITH ALL IMAGES
async function shareProduct(){
  const shareBtn = event.target.closest('.btn-share');
  const originalContent = shareBtn.innerHTML;
  
  try {
    shareBtn.innerHTML = '<span>‚è≥</span>';
    shareBtn.disabled = true;
    
    if(!navigator.share){
      copyToClipboard(window.location.href);
      showToast("Link copied to clipboard!");
      return;
    }
    
    // Try sharing with files
    const filesArray = [];
    
    for(let i = 0; i < Math.min(currentProduct.images.length, 5); i++){
      try {
        const response = await fetch(currentProduct.images[i]);
        const blob = await response.blob();
        
        const file = new File(
          [blob],
          `sider-lehenga-${currentProduct.id}-${i+1}.jpg`,
          { type: "image/jpeg" }
        );
        
        filesArray.push(file);
      } catch(e){
        console.log("Image fetch failed:", e);
      }
    }
    
    const shareData = {
      title: currentProduct.title + " - Sider Lehenga",
      text: `Check out this beautiful ${currentProduct.title} 
Price: ‚Çπ${currentProduct.price.toLocaleString('en-IN')}

Shop now at Sider Lehenga - Premium Ethnic Wear üõçÔ∏è`,
      url: window.location.href,
      files: filesArray
    };
    
    if(navigator.canShare && navigator.canShare(shareData)){
      await navigator.share(shareData);
      showToast("Shared successfully! ‚úì");
    } else {
      // Fallback without files
      await navigator.share({
        title: shareData.title,
        text: shareData.text,
        url: shareData.url
      });
      showToast("Shared successfully! ‚úì");
    }
    
  } catch(err){
    if(err.name !== 'AbortError'){
      copyToClipboard(window.location.href);
      showToast("Link copied to clipboard!");
    }
  } finally {
    shareBtn.innerHTML = originalContent;
    shareBtn.disabled = false;
  }
}

function copyToClipboard(text){
  const textarea = document.createElement("textarea");
  textarea.value = text;
  textarea.style.position = "fixed";
  textarea.style.opacity = "0";
  document.body.appendChild(textarea);
  textarea.select();
  document.execCommand("copy");
  document.body.removeChild(textarea);
}

function showToast(message){
  const toast = document.createElement("div");
  toast.className = "toast";
  toast.textContent = message;
  document.body.appendChild(toast);
  
  setTimeout(() => toast.classList.add("show"), 100);
  setTimeout(() => {
    toast.classList.remove("show");
    setTimeout(() => toast.remove(), 300);
  }, 2500);
}

function loadSimilarProducts(currentId){
  const strip = document.getElementById("similarProducts");
  
  let otherProducts = allProducts.filter(p => p.id !== currentId);
  otherProducts = shuffleArray(otherProducts, currentId);
  
  otherProducts.slice(0, 8).forEach(p => {
    const card = document.createElement("div");
    card.className = "mini-card";
    card.onclick = () => {
      window.scrollTo(0, 0);
      location.href = `product.html?id=${p.id}`;
    };
    
    card.innerHTML = `
      <img src="${p.images[0]}" alt="${p.title}" loading="lazy">
      <div class="mini-card-body">
        <div class="mini-card-title">${p.title.slice(0, 50)}${p.title.length > 50 ? '...' : ''}</div>
        <div class="mini-card-price">‚Çπ${p.price.toLocaleString('en-IN')}</div>
      </div>
    `;
    
    strip.appendChild(card);
  });
}

function shuffleArray(array, seed){
  const arr = [...array];
  let currentIndex = arr.length;
  
  const seededRandom = (max) => {
    seed = (seed * 9301 + 49297) % 233280;
    return (seed / 233280) * max;
  };
  
  while(currentIndex != 0){
    let randomIndex = Math.floor(seededRandom(currentIndex));
    currentIndex--;
    [arr[currentIndex], arr[randomIndex]] = [arr[randomIndex], arr[currentIndex]];
  }
  
  return arr;
}

function selectSize(element){
  document.querySelectorAll(".size-option").forEach(s => s.classList.remove("selected"));
  element.classList.add("selected");
  selectedSize = element.textContent;
}

function addToCart(){
  showToast(`Added to cart! Size: ${selectedSize} üõí`);
  
  // Add to cart logic here
  let cart = JSON.parse(localStorage.getItem("cart") || "[]");
  cart.push({
    id: currentProduct.id,
    title: currentProduct.title,
    price: currentProduct.price,
    image: currentProduct.images[0],
    size: selectedSize,
    quantity: 1
  });
  localStorage.setItem("cart", JSON.stringify(cart));
}

function buyNow(){
  addToCart();
  setTimeout(() => {
    location.href = "cart.html";
  }, 500);
}

// Keyboard navigation
document.addEventListener("keydown", (e) => {
  const lightbox = document.getElementById("lightbox");
  
  if(lightbox.classList.contains("active")){
    if(e.key === "Escape") closeLightbox();
    if(e.key === "ArrowLeft") changeLightboxImage(-1);
    if(e.key === "ArrowRight") changeLightboxImage(1);
  } else {
    if(e.key === "ArrowLeft") changeMainImage(-1);
    if(e.key === "ArrowRight") changeMainImage(1);
  }
});

loadProduct();
</script>

</body>
</html>